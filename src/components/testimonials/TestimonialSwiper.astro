---
import testimonialImage from "@images/testimonials/man.png";
import ArrowLeft from "@tabler/icons/outline/arrow-left.svg";
import ArrowRight from "@tabler/icons/outline/arrow-right.svg";
import { Image } from "astro:assets";

import { getLocaleFromUrl } from "@/js/localeUtils";
import { getTranslatedData } from "@/js/translationUtils";

import TestimonialSwiperCard from "./TestimonialSwiperCard.astro";

// data
const currLocale = getLocaleFromUrl(Astro.url);
const testimonials = getTranslatedData("testimonialData", currLocale);
const testimonialsSlice = testimonials.slice(0, 6);
---

<section id="testimonial-swiper" class="relative overflow-hidden py-20">
	<div class="site-container">
		<div class="mx-auto mb-20 text-center md:max-w-5xl" data-mos="fade-up">
			<h2 class="h2">What people are saying</h2>
		</div>
		<div
			class="border-border relative overflow-hidden rounded-3xl border p-3 shadow-md"
			data-mos="fade-up"
			data-mos-delay="0.3"
		>
			<div class="relative z-10 flex h-full flex-col lg:flex-row lg:items-stretch">
				<div class="flex h-full items-center justify-center p-6 lg:w-1/3">
					<Image
						src={testimonialImage}
						quality={100}
						alt="Testimonial profile"
						class="h-auto w-auto max-w-full"
					/>
				</div>
				<div class="w-full p-6 lg:w-2/3">
					<div class="testimonials-slider w-full overflow-hidden">
						<div class="swiper-wrapper">
							{
								testimonialsSlice.map((testimonial) => (
									<TestimonialSwiperCard testimonial={testimonial} />
								))
							}
						</div>
					</div>
					<div class="flex justify-end space-x-4">
						<button class="testimonial-prev group" aria-label="Previous testimonial">
							<div
								class="hover:border-muted-foreground border-border flex size-14 items-center justify-center rounded-full border transition duration-200 md:size-18"
							>
								<ArrowLeft class="opacity-90" />
							</div>
						</button>
						<button class="testimonial-next group" aria-label="Next testimonial">
							<div
								class="hover:border-muted-foreground border-border flex size-14 items-center justify-center rounded-full border transition duration-200 md:size-18"
							>
								<ArrowRight class="opacity-90" />
							</div>
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<script>
	import "swiper/css";

	import Swiper from "swiper";
	import { A11y, Autoplay, Keyboard, Navigation } from "swiper/modules";

	const initTestimonialSwiper = () => {
		const swiperElement = document.querySelector(".testimonials-slider");
		if (!swiperElement) return;

		// Initialize Swiper
		const swiper = new Swiper(".testimonials-slider", {
			modules: [Navigation, Keyboard, A11y, Autoplay],
			slidesPerView: 1,
			spaceBetween: 0,
			grabCursor: true,
			loop: true,
			autoplay: {
				delay: 8000,
				disableOnInteraction: false,
			},
			keyboard: {
				enabled: true,
			},
			navigation: {
				nextEl: ".testimonial-next",
				prevEl: ".testimonial-prev",
			},
			a11y: {
				prevSlideMessage: "Previous testimonial",
				nextSlideMessage: "Next testimonial",
			},
		});

		return swiper;
	};

	// Initialize on page load
	initTestimonialSwiper();

	// Re-initialize after view transitions
	document.addEventListener("astro:after-swap", () => {
		initTestimonialSwiper();
	});
</script>

<style>
	.testimonials-slider {
		overflow: hidden;
	}

	.swiper-slide {
		height: auto;
	}
</style>
